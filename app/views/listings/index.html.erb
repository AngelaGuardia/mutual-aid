<%= render "layouts/view_header", resource: @listings.first %>

<%= render "search_boxes" %>

<br><hr><br>

<table class="table table-hover table-curved table-condensed">
  <thead>
    <tr>
      <th>Type</th>
      <th>Title</th>
      <th>Person</th>
      <th>Category</th>
      <th>Service Area</th>
      <th>Created</th>
      <th>Match</th>
      <th>Respond</th>
      <!-- <th>Find Match</th>-->
      <th>Triage/edit</th>
    </tr>
  </thead>

  <tbody>
    <% @listings.each do |listing| %>
      <% unmatched = listing.status == "unmatched" %>
      <tr>
        <td style="white-space: nowrap">
          <span class="<%= listing.icon_class %>"></span> <%= listing.type %>
        </td>
        <td><%= listing.title %></td>
        <td><%= listing.person&.name %></td>
        <td><%= listing.all_tags_to_s.upcase %></td>
        <td><%= listing.service_area&.name %></td>
        <td><%= shorthand_display(listing.created_at) %></td>
        <td style="white-space: nowrap" title="<%= listing.status %>">
          <% if unmatched %>
            <span class="tag is-warning is-light">
              <%= listing.status %><%= " (#{listing.matches.count})" if listing.matches.count > 1 %>
            </span>
            <span class="tag <%= 'is-warning fa fa-exclamation' %>"></span>
          <% else %>
            <% if listing.matches.count > 1 %>
              <%= link_to "Matches #{" (#{listing.matches.count})"}", matches_path(match_ids: listing.matches.map(&:id)), class: "button is-primary is-outlined" %>
            <% else %>
              <%= link_to "Match", edit_match_path(listing.matches.last), class: "button is-primary is-outlined" %>
            <% end %>
          <% end %>
        </td>
        <td><%= link_to("Respond", respond_contribution_path(listing, contribution_type: listing.type),
                        class: "button #{unmatched ? "is-primary" : "is-primary is-outlined"}") %>
        </td>
        <!-- # TODO - add find match functionality <td><%##= link_to("Find Match [TBD]", match_listing_path(listing), class: "button") %></td>-->
        <td>
          <% button_css_class = "#{unmatched ? "is-primary is-outlined" : "is-primary"}" %>
          <%= triage_button(listing, button_css_class) %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>
