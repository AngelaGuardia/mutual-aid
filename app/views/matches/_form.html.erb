<%= simple_form_for @match do |f| %>
  <%= f.error_notification %>

  <div class="form-inputs">
    <% if @match.receiver_id && @match.provider_id %>
      <div class="is-grouped is-inline-flex">
        <div class="field">
          <%= f.label :profile, class: "label" %>
          <div class="">
            <%= show_button(@match.receiver, @match.receiver.person.name, "fa fa-user-circle") %>
          </div>
        </div>
        <%= f.input :receiver_id, as: :select, include_blank: true, collection: @matched_asks, selected: @match.receiver_id %>
        <%= f.hidden_field :receiver_type, value: "Ask" %>
      </div>

      <div class="is-grouped is-inline-flex">
        <div class="field">
          <%= f.label :profile, class: "label" %>
          <div class="">
            <%= show_button(@match.provider, @match.provider.person.name, "fa fa-user-circle") if @match.provider%>
          </div>
        </div>
        <%= f.input :provider_id, as: :select, include_blank: true, collection: @matched_offers, selected: @match.provider_id %>
        <%= f.hidden_field :provider_type, value: "Offer" %>
      </div>
    <% else %>
      <% if @receiver.present? || @match.receiver_id %>
        <% receiver = @receiver || @match.receiver %>
        <div>for: </div><span class="title"><%= receiver&.name %></span></div>
        <%= f.hidden_field :receiver_id, value:receiver&.id %>
        <%= f.hidden_field :receiver_type, value: receiver&.type %>
        <% if receiver %>
          <div class="contact-info">
            <%= show_button(receiver, receiver.person&.name, "fa fa-user-circle") %>
            <br>
            <span class="<%= receiver.person.preferred_contact_method.icon_class %>"></span>
            <span><%= receiver.person.preferred_contact_info %></span>
          </div>
        <% end %>
        <hr>
      <% else %>
        <%= f.input :receiver_id, as: :select, include_blank: true, collection: @unmatched_asks, selected: params[:receiver_id] %>
        <%= f.hidden_field :receiver_type, value: "Ask" %>
      <% end %>

      <% if @provider.present? || @match.provider_id %>
        <% provider = @provider || @match.provider %>
        <div>for: </div><span class="title"><%= provider&.name %></span></div>
        <%= f.hidden_field :provider_id, value: provider&.id %>
        <%= f.hidden_field :provider_type, value: provider&.type %>
        <% if provider %>
          <div class="contact-info">
            <%= show_button(provider, provider.person&.name, "fa fa-user-circle") %>
            <br>
            <span class="<%= provider.person.preferred_contact_method.icon_class %>"></span>
            <span><%= provider.person.preferred_contact_info %></span>
          </div>
        <% end %>
        <hr>
        <%= f.input :receiver_id, as: :select, include_blank: true, collection: @unmatched_asks, selected: params[:receiver_id] %>
        <%= f.hidden_field :receiver_type, value: "Ask" %>
      <% else %>
        <%= f.input :provider_id, as: :select, include_blank: true, collection: @unmatched_offers, selected: params[:provider_id] %>
        <%= f.hidden_field :provider_type, value: "Offer" %>
      <% end %>
    <% end %>


    <div class="field is-grouped">
      <%= f.input :notes, as: :text, label: "Match notes", input_html: { rows: 2, style: "width: 45em" } %>
    </div>
    <div class="field is-grouped">
      <%#= f.input :tentative, as: :radio_buttons, checked: true %>
      <%#= f.input :completed, as: :radio_buttons, checked: false %>
      <%= f.input :status, as: :select, required: true, collection: @statuses || [], selected: f.object.status || params[:status] || "matched_tentatively" %>
    </div>

    <% save_and_show_button = f.submit "Save and View Match", class: "button mt-1 is-primary" %>
    <%= render "layouts/view_footer_buttons", f: f, resource: @match, top_divider: true, extra_form_button_1: nil, button_class: "is-primary is-outlined", extra_form_button_2: save_and_show_button %>
<% end %>
