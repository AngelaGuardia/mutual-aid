#!/usr/bin/env bash

set -e

function dc() {
  docker-compose -f docker/development/docker-compose.yml run --rm "$@"
}

# start fresh
bin/dev/clean

# will create the app container, create both dev and test databases, and seed dev
dc app bin/rails db:reset

# only the test db needs to be explicitly seeded
dc app bin/rails db:seed RAILS_ENV=test

# build the image and make sure webpack can compile; don't start webpack-dev-server
dc webpacker bin/webpack

# build the image; don't start mailcatcher yet
dc email echo done!
